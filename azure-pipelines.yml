# Nombre del pipeline
name: 0.$(Date:yyMMdd)$(Rev:.r)  # Trying to set '$(Build.BuildNumber)'
# Variables definidas para el pipeline (ajusta estos valores según tu configuración)
variables:
  #---v EDITABLE-----------------------------------------------------------------------------------------------
  - name: MY_SONAR_KEY
    value: com.veradat.node.manager:veradat-node-manager
  - name: COMPONENT_NAME
    value: veradat-node-manager
  #---^ EDITABLE-----------------------------------------------------------------------------------------------
  - name: system.debug
    value: 'true'
  - name: JAVA_HOME_21_X64
    value: /usr/lib/jvm/jdk-21.0.2
  - name: JDK_VERSION
    value: '1.21'
  - name: JAVA_HOME_17_X64
    value: /usr/lib/jvm/java-17-openjdk-amd64
  - name: MAVEN
    value: /opt/maven
  - name: MAVEN_CACHE_FOLDER
    value: $(Pipeline.Workspace)/.m2/repository
  - name: MAVEN_OPTS
    value: '-Xmx1024m -Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)'
resources:
  repositories:
    - repository: pipeline-template
      type: git
      name: iac/pipeline-template
      ref: veradat-feb-node
    - repository: self

trigger:
  branches:
    include:
      - development
      - integration*

pool: Default
steps:
  - checkout: self
    fetchDepth: 0

  - checkout: pipeline-template

  - task: CopyFiles@2
    displayName: 'Copy Files from: /opt/apache-maven-3.9.4/conf/'
    inputs:
      SourceFolder: '/opt/apache-maven-3.9.4/conf/'
      Contents: settings.xml
      TargetFolder: '$(System.DefaultWorkingDirectory)/$(COMPONENT_NAME)/conf'

  - template:
      steps/java-microservice-build.yaml@pipeline-template
    parameters:
      mySonarKey: $(MY_SONAR_KEY)
      pomPath: $(Build.Repository.Name)
      mavenPath: $(MAVEN)
      mavenCachePath: $(MAVEN_CACHE_FOLDER)
      mavenOpts: $(MAVEN_OPTS)
      targetPath: target
      mendApplication: veradat-node
      mendNonProdApplication: non-prod-veradat-node
      jdkVersion: $(JDK_VERSION)